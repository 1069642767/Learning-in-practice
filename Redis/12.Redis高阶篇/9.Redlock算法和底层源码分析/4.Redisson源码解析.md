#### 加锁、可重入、续命、解锁

### 分析步骤

- Redis分布式锁过期了，但是业务逻辑还没有处理完怎么办

  需要给对应的key续期

- 守护线程“续命”

  <font color = 'red'>额外起一个线程，定期检查线程是否还持有锁，如果有则延长过期时间</font>；

  Redisson里面就实现了这个方案，使用“看门狗”定期检查（每1/3的锁时间检查1次），如果线程还持有锁，则刷新过期时间。

- 在获取锁成功后，给锁加一个watchdog，watchdog会起一个定时任务，在锁没有被释放且快要过期的时候会续期

  ![](images/12.看门狗续期.jpg)

- 上述源码分析1

  通过Redisson新建出来的锁key，默认是30秒

  ![](images/13.看门狗默认时间30秒.jpg)

- 上述源码分析2：缓存续期

  ![](images/14.源码分析2.jpg)

- 

