# Redis分布式锁-Redlock红锁算法 Distributed locks with Redis

### 官网说明

https://redis.io/docs/manual/patterns/distributed-locks/

主页说明

![](images/3.RedLock.jpg)

![](images/4.官网翻译.jpg)

### 为什么学习这个？怎么产生的？

<font color = 'red'>之前手写的分布式锁有什么缺点：</font>

官网说明：![](images/5.基于故障转移的实施是不够的.jpg)

翻译：![](images/6.翻译.jpg)

有时在特殊情况下，例如在故障期间，多个客户端可以同时持有锁是完全没问题的。如果是这种情况，您可以使用基于复制的解决方案。否则，我们建议实施本文档中描述的解决方案。

线程1首先获取锁成功，将键值对写入redis 的 master节点，在 redis将该键值对同步到slave 节点之前，master发生了故障；

redis触发故障转移，其中一个slave升级为新的 master，此时新上位的master并不包含线程1写入的键值对，因此线程⒉尝试获取锁也可以成功拿到锁，<font color = 'red'>此时相当于有两个线程获取到了锁，可能会导致各种预期之外的情况发生，例如最常见的脏数据。</font>

我们加的是排它独占锁，同一时间只能有一个建redis锁成功并持有锁，严禁出现2个以上的请求线程拿到锁。













